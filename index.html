<!-- Chosen Palette: Dark Mode (Inspired by image) -->

<!-- Application Structure Plan: A multi-section, single-page application design was chosen to provide a clear, task-oriented user experience. The structure uses a persistent bottom navigation bar to switch between four distinct sections: 1) a "Home" dashboard for immediate situational awareness (sync status, critical advisories, latest bulletins, and a new data visualization of seismic activity); 2) a "Safety" section for proactive, AI-generated preparedness guides; 3) a "Maps" section with AI-powered tools for location-specific hazard search and the new Request Help and Rescuer Alerts; and 4) a "Reports" section for community-driven interaction, including an emergency SOS beacon and a real-time feed of user-submitted reports. This architecture separates official data from user-generated content and tools, preventing cognitive overload and allowing users to navigate directly to the information or action they need most during a crisis. The flow is designed to be intuitive and mobile-first, prioritizing clarity and speed of access. The 'Reports' page now serves as the 'Emergency SOS & Contacts' hub. -->

<!-- Visualization & Content Choices: Report Info: Recent earthquake events (magnitude, depth, date). -> Goal: Compare & see relationships. -> Viz/Method: Interactive Bubble Chart showing depth vs. date, with bubble size representing magnitude. -> Interaction: Tooltip on hover displays detailed info for each quake. -> Library/Method: Chart.js (Canvas). Report Info: Official Advisories & Bulletins. -> Goal: Inform. -> Viz/Method: Styled HTML cards with clear typography and color-coding for severity. -> Interaction: None. -> Justification: Cards are highly scannable on mobile for urgent information. -> Library/Method: HTML/CSS. Report Info: Safety Guides. -> Goal: Inform. -> Viz/Method: Dynamically updated text block. -> Interaction: User selects topic via buttons to trigger AI content generation. -> Justification: Keeps UI clean by showing only relevant information on demand. -> Library/Method: JS/API. Report Info: Community-submitted reports. -> Goal: Organize & Inform. -> Viz/Method: Real-time feed of styled cards. -> Interaction: Form submission. -> Justification: Provides live, ground-truth information from other users. -> Library/Method: HTML/CSS + Firebase. -->

<!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->

<!doctype html>

<html lang="en">

<head>

Â  Â  <meta charset="UTF-8" />

Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

Â  Â  <title>QuakeSafe - Interactive Disaster Hub</title>

Â  Â Â 

Â  Â  <script src="https://cdn.tailwindcss.com"></script>

Â  Â  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

Â  Â Â 

Â  Â  <!-- Date Adapter for Chart.js 'time' scale -->

Â  Â  <script src="https://cdn.jsdelivr.net/npm/date-fns/dist/date-fns.umd.min.js"></script>

Â  Â  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>

Â  Â Â 

Â  Â  <!-- Firebase SDK (Compat versions for global access in single HTML file) -->

Â  Â  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>

Â  Â  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>

Â  Â  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>



Â  Â  <!-- React and Babel (Use createRoot for React 18 compatibility) -->

Â  Â  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>

Â  Â  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

Â  Â  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

Â  Â Â 

Â  Â  <link rel="preconnect" href="https://fonts.googleapis.com">

Â  Â  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

Â  Â  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Fira+Code&display=swap" rel="stylesheet">



Â  Â  <style>

Â  Â  Â  Â  /* UPDATED: Global Dark Background based on user's image */

Â  Â  Â  Â  body {

Â  Â  Â  Â  Â  Â  background-color: #1A202C;Â 

Â  Â  Â  Â  Â  Â  font-family: 'Inter', sans-serif;

Â  Â  Â  Â  Â  Â  color: #E2E8F0; /* Light text for dark background */

Â  Â  Â  Â  }

Â  Â  Â  Â  .chart-container {

Â  Â  Â  Â  Â  Â  position: relative;

Â  Â  Â  Â  Â  Â  width: 100%;

Â  Â  Â  Â  Â  Â  max-width: 800px;

Â  Â  Â  Â  Â  Â  margin-left: auto;

Â  Â  Â  Â  Â  Â  margin-right: auto;

Â  Â  Â  Â  Â  Â  height: 300px;

Â  Â  Â  Â  }

Â  Â  Â  Â  @media (min-width: 640px) {

Â  Â  Â  Â  Â  Â  .chart-container {

Â  Â  Â  Â  Â  Â  Â  Â  height: 400px;

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }

Â  Â  Â  Â Â 

Â  Â  Â  Â  /* Typography adjustments for Dark Mode */

Â  Â  Â  Â  .prose h3 {

Â  Â  Â  Â  Â  Â  font-size: 1.25rem;

Â  Â  Â  Â  Â  Â  font-weight: 800;

Â  Â  Â  Â  Â  Â  margin-top: 1.5rem;

Â  Â  Â  Â  Â  Â  margin-bottom: 0.5rem;

Â  Â  Â  Â  Â  Â  color: #CBD5E0; /* Lighter heading color */

Â  Â  Â  Â  }

Â  Â  Â  Â  .prose p, .prose li {

Â  Â  Â  Â  Â  Â  font-size: 1rem;

Â  Â  Â  Â  Â  Â  line-height: 1.6;

Â  Â  Â  Â  Â  Â  color: #A0AEC0; /* Subdued text color */

Â  Â  Â  Â  }

Â  Â  Â  Â  .prose ul, .prose ol {

Â  Â  Â  Â  Â  Â  padding-left: 1.5rem;

Â  Â  Â  Â  }



Â  Â  Â  Â  /* Styling for the Reports Page (which was already dark, now ensuring consistency) */

Â  Â  Â  Â  .reports-dark-bg {

Â  Â  Â  Â  Â  Â  background-color: #1A202C; /* Match body background */

Â  Â  Â  Â  Â  Â  min-height: 100vh;

Â  Â  Â  Â  }

Â  Â  Â  Â  .reports-text-light {

Â  Â  Â  Â  Â  Â  color: #E2E8F0;

Â  Â  Â  Â  }

Â  Â  Â  Â  /* Ensure dark cards look good on the dark background */

Â  Â  Â  Â  .reports-card-dark {

Â  Â  Â  Â  Â  Â  background-color: #2D3748;

Â  Â  Â  Â  Â  Â  border-color: #4A5568;

Â  Â  Â  Â  Â  Â  color: #E2E8F0;

Â  Â  Â  Â  }

Â  Â  Â  Â Â 

Â  Â  Â  Â  /* Toast notification styles */

Â  Â  Â  Â  .toast {

Â  Â  Â  Â  Â  Â  position: fixed;

Â  Â  Â  Â  Â  Â  bottom: 6rem;

Â  Â  Â  Â  Â  Â  left: 50%;

Â  Â  Â  Â  Â  Â  transform: translateX(-50%);

Â  Â  Â  Â  Â  Â  color: white;

Â  Â  Â  Â  Â  Â  padding: 1rem 1.5rem;

Â  Â  Â  Â  Â  Â  border-radius: 0.5rem;

Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.5);

Â  Â  Â  Â  Â  Â  opacity: 0;

Â  Â  Â  Â  Â  Â  transition: opacity 0.3s ease-in-out;

Â  Â  Â  Â  Â  Â  z-index: 100;

Â  Â  Â  Â  }

Â  Â  Â  Â  .toast.show {

Â  Â  Â  Â  Â  Â  opacity: 1;

Â  Â  Â  Â  }

Â  Â  Â  Â Â 

Â  Â  Â  Â  /* Full-screen flash overlay for MapsPage */

Â  Â  Â  Â  .flash-overlay {

Â  Â  Â  Â  Â  Â  position: fixed;

Â  Â  Â  Â  Â  Â  top: 0;

Â  Â  Â  Â  Â  Â  left: 0;

Â  Â  Â  Â  Â  Â  width: 100vw;

Â  Â  Â  Â  Â  Â  height: 100vh;

Â  Â  Â  Â  Â  Â  z-index: 50; /* Below toast, above content */

Â  Â  Â  Â  Â  Â  pointer-events: none; /* Allows clicks to pass through */

Â  Â  Â  Â  Â  Â  transition: background-color 0.1s ease-in-out;

Â  Â  Â  Â  }

Â  Â  </style>

Â  Â Â 

Â  Â  <script>

Â  Â  Â  tailwind.config = {

Â  Â  Â  Â  theme: {

Â  Â  Â  Â  Â  extend: {

Â  Â  Â  Â  Â  Â  colors: {

Â  Â  Â  Â  Â  Â  Â  // UPDATED DARK MODE PALETTE

Â  Â  Â  Â  Â  Â  Â  'background': '#1A202C', // Deep Slate/Navy

Â  Â  Â  Â  Â  Â  Â  'surface': '#2D3748',Â  Â  // Slightly lighter card/component background

Â  Â  Â  Â  Â  Â  Â  'primary': '#4299E1',Â  Â  // Vibrant Blue for primary actions/links (was brown)

Â  Â  Â  Â  Â  Â  Â  'secondary': '#4A5568',Â  // Border/Divider color

Â  Â  Â  Â  Â  Â  Â  'text-primary': '#E2E8F0', // Near White for main text

Â  Â  Â  Â  Â  Â  Â  'text-secondary': '#A0AEC0', // Light Gray for sub-text

Â  Â  Â  Â  Â  Â  Â  'accent-red': '#E53E3E', // Red for critical alerts

Â  Â  Â  Â  Â  Â  Â  'accent-orange': '#F6AD55', // Orange for high alerts

Â  Â  Â  Â  Â  Â  Â  'accent-blue': '#4299E1', // Primary blue

Â  Â  Â  Â  Â  Â  Â  'accent-green': '#48BB78', // Green for success/online

Â  Â  Â  Â  Â  Â  Â  // Custom colors

Â  Â  Â  Â  Â  Â  Â  'sync-blue': '#3B82F6', // Brighter blue for sync button

Â  Â  Â  Â  Â  Â  Â  'help-red': '#E53E3E',Â  // Red for request help button (same as accent-red)

Â  Â  Â  Â  Â  Â  Â  'help-red-hover': '#C53030',Â 

Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  fontFamily: {

Â  Â  Â  Â  Â  Â  Â  sans: ['Inter', 'sans-serif'],

Â  Â  Â  Â  Â  Â  Â  mono: ['Fira Code', 'monospace'],

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }

Â  Â  Â  }

Â  Â  </script>

</head>

<body class="bg-background">

Â  Â  <div id="root"></div>



Â  Â  <script type="text/babel">

Â  Â  Â  Â  const { useState, createContext, useContext, useEffect, useCallback, useRef } = React;



Â  Â  Â  Â  // --- 0. API & Firebase Configuration ---

Â  Â  Â  Â  const API_KEY = "";Â 

Â  Â  Â  Â  const API_MODEL = "gemini-2.5-flash-preview-05-20";

Â  Â  Â  Â  const cn = (...classes) => classes.filter(Boolean).join(' ');



Â  Â  Â  Â  async function callApiWithRetry(payload, useGrounding = false) {

Â  Â  Â  Â  Â  Â  const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${API_MODEL}:generateContent?key=${API_KEY}`;

Â  Â  Â  Â  Â  Â  if (useGrounding) {

Â  Â  Â  Â  Â  Â  Â  Â  payload.tools = [{ "google_search": {} }];

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  for (let i = 0; i < 3; i++) {

Â  Â  Â  Â  Â  Â  Â  Â  try {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(apiUrl, {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  method: 'POST',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  headers: { 'Content-Type': 'application/json' },

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  body: JSON.stringify(payload)

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!response.ok) throw new Error(`API Error: ${response.status}`);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return await response.json();

Â  Â  Â  Â  Â  Â  Â  Â  } catch (error) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (i === 2) throw error;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await new Promise(res => setTimeout(res, 1000 * Math.pow(2, i)));

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  }



Â  Â  Â  Â  const FirebaseContext = createContext(null);

Â  Â  Â  Â  const useFirebase = () => useContext(FirebaseContext);



Â  Â  Â  Â  function FirebaseProvider({ children }) {

Â  Â  Â  Â  Â  Â  const [services, setServices] = useState({ db: null, auth: null, userId: null, isReady: false, appId: 'default' });

Â  Â  Â  Â  Â  Â  useEffect(() => {

Â  Â  Â  Â  Â  Â  Â  Â  try {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // FIX 2.1: Check if the global 'firebase' object is loaded before proceeding

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (typeof firebase === 'undefined' || typeof firebase.initializeApp === 'undefined') {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error("Firebase SDK is not loaded. Please check script tags.");

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const fireBaseGlobal = window.firebase;



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const app = fireBaseGlobal.initializeApp(firebaseConfig);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const auth = fireBaseGlobal.auth();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const db = fireBaseGlobal.firestore();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // FIX: Add debug logging to help diagnose connectivity issues.

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fireBaseGlobal.firestore.setLogLevel('debug');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const authAction = async () => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  try {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const token = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (token) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await auth.signInWithCustomToken(token);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await auth.signInAnonymously();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } catch (e) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("Auth failed:", e);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  auth.onAuthStateChanged(user => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const userId = user ? user.uid : 'anon-' + crypto.randomUUID();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setServices({ db, auth, userId, isReady: true, appId });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  authAction();

Â  Â  Â  Â  Â  Â  Â  Â  } catch (error) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("Firebase init failed", error);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Still mark as ready so the UI doesn't hang, but db/auth will be null

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setServices(s => ({ ...s, isReady: true }));Â 

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  }, []);

Â  Â  Â  Â  Â  Â  return <FirebaseContext.Provider value={services}>{children}</FirebaseContext.Provider>;

Â  Â  Â  Â  }



Â  Â  Â  Â  // --- 1. Icons ---

Â  Â  Â  Â  const HomeIcon = () => 'âŒ‚';

Â  Â  Â  Â  const ShieldIcon = () => 'ðŸ›¡ï¸';

Â  Â  Â  Â  const MapIcon = () => 'ðŸ—ºï¸';

Â  Â  Â  Â  const BellIcon = () => 'ðŸ””';

Â  Â  Â  Â  const PhoneIcon = () => 'ðŸ“ž';Â 

Â  Â  Â  Â  const SyncIcon = () => 'ðŸ”„';Â 

Â  Â  Â  Â  const WarningIcon = () => 'âš ï¸';Â 

Â  Â  Â  Â  const CheckIcon = () => 'âœ…';Â 

Â  Â  Â  Â  const HelpIcon = () => 'ðŸš¨';Â 

Â  Â  Â  Â  const SoundIcon = () => 'ðŸ”Š';Â 

Â  Â  Â  Â  const FlashIcon = () => 'âš¡';Â 

Â  Â  Â  Â  const OnlineDot = () => <span className="inline-block w-3 h-3 rounded-full bg-accent-green mr-1"></span>; // NEW: Online status



Â  Â  Â  Â  // --- 2. UI Components ---

Â  Â  Â  Â  // Toast Notification component for success feedback

Â  Â  Â  Â  function Toast({ message, show, icon = <CheckIcon />, bgColor = 'bg-accent-green' }) {

Â  Â  Â  Â  Â  Â  return (

Â  Â  Â  Â  Â  Â  Â  Â  <div className={cn("toast", show && "show", bgColor)}>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="flex items-center gap-2">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span className="text-xl">{icon}</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>{message}</span>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  );

Â  Â  Â  Â  }



Â  Â  Â  Â  const Card = ({ children, className, variant = 'light' }) => {

Â  Â  Â  Â  Â  Â  const baseClasses = "rounded-xl shadow-md";

Â  Â  Â  Â  Â  Â  const lightClasses = "bg-surface border border-secondary text-text-primary";

Â  Â  Â  Â  Â  Â  const darkClasses = "reports-card-dark border";



Â  Â  Â  Â  Â  Â  return (

Â  Â  Â  Â  Â  Â  Â  Â  <div className={cn(baseClasses, variant === 'dark' ? darkClasses : lightClasses, className)}>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {children}

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  );

Â  Â  Â  Â  };

Â  Â  Â  Â  const Button = ({ children, onClick, disabled, className, id, type = 'button' }) => <button id={id} type={type} onClick={onClick} disabled={disabled} className={cn("px-4 py-2 rounded-lg font-semibold transition-colors shadow-lg active:scale-[0.98]", className)}>{children}</button>;



Â  Â  Â  Â  // --- Contact List Data ---

Â  Â  Â  Â  const emergencyContacts = {

Â  Â  Â  Â  Â  Â  critical: [

Â  Â  Â  Â  Â  Â  Â  Â  Â // This acts as a header/divider for the critical section

Â  Â  Â  Â  Â  Â  Â  Â  Â { type: 'header', name: 'Critical Emergency Numbers', detail: 'These numbers work even without load balance. Use them immediately in emergencies.' }

Â  Â  Â  Â  Â  Â  ],

Â  Â  Â  Â  Â  Â  national: [

Â  Â  Â  Â  Â  Â  Â  Â  { type: 'national', name: 'National Emergency Hotline', detail: 'Police, Fire, Medical Emergencies', number: '911', color: 'bg-accent-red' },

Â  Â  Â  Â  Â  Â  Â  Â  { type: 'national', name: 'NDRRMC Hotline', detail: 'National Disaster Risk Reduction', number: '143', color: 'bg-accent-red' },

Â  Â  Â  Â  Â  Â  Â  Â  { type: 'national', name: 'Philippine Red Cross', detail: 'Emergency medical assistance', number: '143', color: 'bg-accent-red' },

Â  Â  Â  Â  Â  Â  Â  Â  { type: 'national', name: 'PHIVOLCS Hotline', detail: 'Earthquake information and alerts', number: '0284261468', color: 'bg-accent-red' },

Â  Â  Â  Â  Â  Â  ],

Â  Â  Â  Â  Â  Â  local: [

Â  Â  Â  Â  Â  Â  Â  Â  // START OF USER REQUESTED CHANGE: Updated header from "Cebu Province" to "Tibuok Cebu"

Â  Â  Â  Â  Â  Â  Â  Â  { type: 'header', name: 'Local Emergency Services (Tibuok Cebu)', detail: 'Cebu Province and City' },

Â  Â  Â  Â  Â  Â  Â  Â  { type: 'local', name: 'Cebu Provincial DRRM Office', detail: 'Provincial disaster coordination', number: '0322556666', color: 'bg-primary' },

Â  Â  Â  Â  Â  Â  Â  Â  { type: 'local', name: 'Cebu City DRRM Office', detail: 'Cebu City disaster response', number: '0322666666', color: 'bg-primary' },

Â  Â  Â  Â  Â  Â  Â  Â  { type: 'local', name: 'Cebu City Police Office', detail: 'Cebu City law enforcement', number: '0322312222', color: 'bg-primary' },

Â  Â  Â  Â  Â  Â  Â  Â  // END OF USER REQUESTED CHANGE

Â  Â  Â  Â  Â  Â  ]

Â  Â  Â  Â  };



Â  Â  Â  Â  // --- Contact List Sub-Component ---

Â  Â  Â  Â  function EmergencyContactList({ contacts, isNational }) {

Â  Â  Â  Â  Â  Â  return (

Â  Â  Â  Â  Â  Â  Â  Â  <div className="space-y-3">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {contacts.map((contact, index) => {Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (contact.type === 'header') {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return (

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div key={index} className="pt-4 pb-1">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 className="font-bold text-lg reports-text-light">{contact.name}</h3>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p className="text-xs text-gray-400">{contact.detail}</p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <hr className="mt-2 border-gray-600" />

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  );

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Render Call Button Card

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const buttonColorClass = contact.color;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return (

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // **SOS FUNCTIONALITY IS HERE**: The 'tel:' protocol makes the link functional for calling on mobile devices.

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Card key={`${contact.number}-${index}`} variant="dark" className="p-3 shadow-md border-opacity-30">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 className="font-semibold reports-text-light">{contact.name}</h4>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p className="text-sm text-gray-400 mb-2">{contact.detail}</p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <aÂ 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  href={`tel:${contact.number}`}Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  className={cn("flex items-center justify-center gap-2 p-3 rounded-lg font-bold text-white transition-transform active:scale-95", buttonColorClass,Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  contact.color === 'bg-accent-red' ? 'hover:bg-accent-red/80' : 'hover:bg-primary/80')}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  >

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <PhoneIcon /> CALL {contact.number}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </a>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Card>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  );

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  })}

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  );

Â  Â  Â  Â  }



Â  Â  Â  Â  // --- 3. Page Components ---

Â  Â  Â  Â  function HomePage({ bulletins, currentAlert, showToast, isSyncing, handleSync }) {

Â  Â  Â  Â  Â  Â  const [lastSync, setLastSync] = useState("Just now");

Â  Â  Â  Â  Â  Â  const chartRef = useRef(null);

Â  Â  Â  Â  Â  Â  const chartInstanceRef = useRef(null);



Â  Â  Â  Â  Â  Â  // Effect to handle the Chart.js Bubble Chart

Â  Â  Â  Â  Â  Â  useEffect(() => {

Â  Â  Â  Â  Â  Â  Â  Â  if (chartRef.current && bulletins.length > 0) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // FIX 3: Check if Chart is defined globally before attempting to initialize

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (typeof Chart === 'undefined') {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.warn("Chart.js library is not loaded. Cannot display seismic chart.");

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (chartInstanceRef.current) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  chartInstanceRef.current.destroy();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const ctx = chartRef.current.getContext('2d');

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const chartData = {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  datasets: bulletins.filter(b => b.magnitude !== 'N/A').map(b => ({

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  label: b.location,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  data: [{

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  x: new Date(b.date.split(' - ')[0]),

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  y: parseFloat(b.depth),

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  r: parseFloat(b.magnitude) * 4,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }],

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Dark mode compatible colors

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: b.severity === 'extreme' ? 'rgba(229, 62, 62, 0.7)' : b.severity === 'high' ? 'rgba(246, 173, 85, 0.7)' : 'rgba(66, 153, 225, 0.7)',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderColor: b.severity === 'extreme' ? '#E53E3E' : b.severity === 'high' ? '#F6AD55' : '#4299E1',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderWidth: 1,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }))

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  chartInstanceRef.current = new Chart(ctx, {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: 'bubble',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  data: chartData,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  options: {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  responsive: true,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  maintainAspectRatio: false,

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  scales: {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  x: {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: 'time',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  time: { unit: 'day' },

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  title: { display: true, text: 'Date of Event', color: '#A0AEC0' },

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  grid: { color: '#4A5568' }, // Dark grid lines

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ticks: { color: '#E2E8F0' } // Light ticks

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  y: {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  title: { display: true, text: 'Depth (km)', color: '#A0AEC0' },

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  grid: { color: '#4A5568' },

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ticks: { color: '#E2E8F0', reverse: true }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  plugins: {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  legend: { display: false },

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tooltip: {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  callbacks: {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  label: function(context) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const d = context.raw;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return `${context.dataset.label}: Mag ${d.r/4}, Depth ${d.y} km`;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  return () => {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (chartInstanceRef.current) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  chartInstanceRef.current.destroy();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  chartInstanceRef.current = null;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  }, [bulletins]);

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  // Function to update sync status after successful sync

Â  Â  Â  Â  Â  Â  const performSync = async () => {

Â  Â  Â  Â  Â  Â  Â  Â  const success = await handleSync();

Â  Â  Â  Â  Â  Â  Â  Â  if (success) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setLastSync(new Date().toLocaleTimeString());

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showToast('Sync Complete: Latest earthquake data and bulletins downloaded for offline use.');

Â  Â  Â  Â  Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showToast('Sync Failed: Check your internet connection.', <WarningIcon/>, 'bg-accent-red');

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  }





Â  Â  Â  Â  Â  Â  return (

Â  Â  Â  Â  Â  Â  Â  Â  <div className="space-y-6 px-4">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="text-center">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h1 className="text-3xl font-extrabold text-text-primary">QuakeSafe Dashboard</h1>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p className="text-text-secondary mt-1">Situational awareness in a crisis. Easy to use, advanced information. (Sayon gamiton, apan mas gamit!) </p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* Prominent Alert Status Banner */}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className={cn("mt-4 p-3 rounded-xl font-extrabold text-lg transition-all shadow-md", currentAlert.color)}>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  CURRENT STATUS: {currentAlert.level}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {/* NEW Sync Status Card */}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Card className="p-4 md:p-6 space-y-3">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 className="text-xl font-bold text-text-primary mb-3">PHIVOLCS Data Sync</h2>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="flex justify-between items-center pb-2 border-b border-secondary">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 className="font-bold text-lg text-text-primary flex items-center gap-2"><SyncIcon /> Sync Status</h3>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p className="text-sm text-text-secondary">Last synced: <span className="font-semibold">{lastSync}</span></p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Button onClick={performSync} disabled={isSyncing} className="w-full bg-sync-blue hover:bg-primary text-white flex items-center justify-center gap-2 shadow-lg">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <SyncIcon /> {isSyncing ? 'Synchronizing...' : 'Sync Latest PHIVOLCS Data'}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p className="text-xs text-text-secondary text-center">Tap to connect and refresh data for offline use (Requires internet).</p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Card>



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Card className="p-4 md:p-6">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 className="text-xl font-bold text-text-primary mb-3">Recent Seismic Activity</h2>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="chart-container">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <canvas ref={chartRef}></canvas>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <p className="text-xs text-text-secondary text-center mt-2">This chart plots recent earthquakes by date and depth. The size of each bubble corresponds to the earthquake's magnitude. It helps visualize if events are shallow (potentially more damaging) and frequent.</p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Card>



Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 className="text-xl font-bold text-text-primary mb-3">Latest Bulletins</h2>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {bulletins.map((b, i) => (

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Card key={i} className={cn("p-4",Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Adjusted colors for dark mode context

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  b.severity === 'extreme' && "bg-accent-red/20 border-accent-red",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  b.severity === 'high' && "bg-accent-orange/20 border-accent-orange",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  b.severity === 'moderate' && "bg-primary/20 border-primary"

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p className="font-mono text-xs text-text-secondary">{b.number}</p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 className="font-bold text-text-primary">{b.location}</h3>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p className="text-sm mt-1">Mag <span className="font-extrabold">{b.magnitude}</span> at <span className="font-extrabold">{b.depth}</span> depth</p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p className="text-xs text-text-secondary mt-2">{b.date}</p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Card>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ))}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  );

Â  Â  Â  Â  }



Â  Â  Â  Â  function SafetyPage() {

Â  Â  Â  Â  Â  Â  const [content, setContent] = useState('');

Â  Â  Â  Â  Â  Â  const [isLoading, setIsLoading] = useState(false);

Â  Â  Â  Â  Â  Â  const [topic, setTopic] = useState('');

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  const topics = {

Â  Â  Â  Â  Â  Â  Â  Â  'Kit': 'Generate a detailed checklist for an earthquake survival kit for a Filipino family.',

Â  Â  Â  Â  Â  Â  Â  Â  'During': 'What are the exact steps to take during a strong earthquake inside a building?',

Â  Â  Â  Â  Â  Â  Â  Â  'After': 'List the immediate safety checks and actions after an earthquake has stopped.'

Â  Â  Â  Â  Â  Â  };



Â  Â  Â  Â  Â  Â  const getAdvice = useCallback(async (selectedTopic) => {

Â  Â  Â  Â  Â  Â  Â  Â  if (!selectedTopic) return;

Â  Â  Â  Â  Â  Â  Â  Â  setIsLoading(true);

Â  Â  Â  Â  Â  Â  Â  Â  setContent('');

Â  Â  Â  Â  Â  Â  Â  Â  setTopic(selectedTopic);

Â  Â  Â  Â  Â  Â  Â  Â  const systemPrompt = "You are a disaster preparedness expert. Provide clear, concise, actionable advice in Markdown format. Use headings and lists.";

Â  Â  Â  Â  Â  Â  Â  Â  try {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const payload = { contents: [{ parts: [{ text: topics[selectedTopic] }] }], systemInstruction: { parts: [{ text: systemPrompt }] } };

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const result = await callApiWithRetry(payload);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setContent(result.candidates[0].content.parts[0].text);

Â  Â  Â  Â  Â  Â  Â  Â  } catch (e) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setContent("Error fetching safety advice. Please check your connection.");

Â  Â  Â  Â  Â  Â  Â  Â  } finally {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setIsLoading(false);

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  }, []);



Â  Â  Â  Â  Â  Â  useEffect(() => { getAdvice('Kit'); }, [getAdvice]);



Â  Â  Â  Â  Â  Â  return (

Â  Â  Â  Â  Â  Â  Â  Â  <div className="space-y-6 px-4">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <div className="text-center">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h1 className="text-3xl font-extrabold text-text-primary">Safety & Preparedness</h1>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p className="text-text-secondary mt-1">This section provides proactive, life-saving information. Use these AI-generated guides to prepare your family and know what to do in specific scenarios before, during, and after an earthquake.</p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Card className="p-4 flex justify-center gap-2 bg-surface">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {Object.keys(topics).map(t => (

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Button key={t} onClick={() => getAdvice(t)} disabled={isLoading || topic === t}Â 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  className={cn(

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  topic === t ? "bg-primary text-white" : "bg-secondary/50 text-text-primary",

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "hover:bg-primary/80 hover:text-white"

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  )}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  >

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {t}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ))}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Card>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Card className="p-4 md:p-6 min-h-[300px] bg-surface">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {isLoading ? <p className="text-text-secondary">Generating advice...</p> : <div className="prose" dangerouslySetInnerHTML={{ __html: content.replace(/\n/g, '<br />').replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/##\s(.*?)/g, '<h3>$1</h3>') }}></div>}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </Card>

Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  );

Â  Â  Â  Â  }



Â  Â  Â  Â  function MapsPage({ showToast }) {

Â  Â  Â  Â  Â  Â  const { db, userId, appId, isReady } = useFirebase();

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  // Hazard Search States

Â  Â  Â  Â  Â  Â  const [query, setQuery] = useState('');

Â  Â  Â  Â  Â  Â  const [result, setResult] = useState(null);

Â  Â  Â  Â  Â  Â  const [isLoading, setIsLoading] = useState(false);

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  // Request Help States

Â  Â  Â  Â  Â  Â  const [helpForm, setHelpForm] = useState({ items: '', people: '', notes: '', contact: '' });

Â  Â  Â  Â  Â  Â  const [isRequesting, setIsRequesting] = useState(false);

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  // Rescuer Alert States (NEW)

Â  Â  Â  Â  Â  Â  const audioContextRef = useRef(null);

Â  Â  Â  Â  Â  Â  const oscillatorRef = useRef(null);

Â  Â  Â  Â  Â  Â  const gainNodeRef = useRef(null);Â 

Â  Â  Â  Â  Â  Â  const flashIntervalRef = useRef(null);



Â  Â  Â  Â  Â  Â  const [isSounding, setIsSounding] = useState(false);

Â  Â  Â  Â  Â  Â  const [isFlashing, setIsFlashing] = useState(false);

Â  Â  Â  Â  Â  Â  const [flashColor, setFlashColor] = useState('bg-yellow-400'); // For visual feedback

Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  const startSoundAlert = () => {

Â  Â  Â  Â  Â  Â  Â  Â  if (isSounding) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  stopSoundAlert();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  // Initialize AudioContext if not already done

Â  Â  Â  Â  Â  Â  Â  Â  if (!audioContextRef.current) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Note: window.AudioContext may be prefixed on some older browsers

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  audioContextRef.current = new (window.AudioContext || window.webkitAudioContext)();

Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  const context = audioContextRef.current;

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  // Create an oscillator (sound source)

Â  Â  Â  Â  Â  Â  Â  Â  const oscillator = context.createOscillator();

Â  Â  Â  Â  Â  Â  Â  Â  oscillator.type = 'sawtooth'; // Piercing sound

Â  Â  Â  Â  Â  Â  Â  Â  oscillator.frequency.setValueAtTime(800, context.currentTime);Â 

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  // Create gain node (volume control)

Â  Â  Â  Â  Â  Â  Â  Â  const gainNode = context.createGain();

Â  Â  Â  Â  Â  Â  Â  Â  gainNode.gain.setValueAtTime(0, context.currentTime);

Â  Â  Â  Â  Â  Â  Â  Â  // Ramp up volume quickly for immediate sound

Â  Â  Â  Â  Â  Â  Â  Â  gainNode.gain.linearRampToValueAtTime(0.5, context.currentTime + 0.05);Â 

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  // Connect nodes

Â  Â  Â  Â  Â  Â  Â  Â  oscillator.connect(gainNode);

Â  Â  Â  Â  Â  Â  Â  Â  gainNode.connect(context.destination);

Â  Â  Â  Â  Â  Â  Â  Â Â 

Â  Â  Â  Â  Â  Â  Â  Â  // Start the sound and store references

Â  Â  Â  Â  Â  Â  Â  Â  oscillator.start();

Â  Â  Â  Â  Â  Â  Â  Â  oscillatorRef.current = oscillator;

Â  Â  Â  Â  Â  Â  Â  Â  gainNodeRef.current = gainNode;Â 

Â  Â  Â  Â  Â  Â  Â  Â  setIsSounding(true);

Â  Â  Â  Â  Â  Â  };



Â  Â  Â  Â  Â  Â  const stopSoundAlert = () => {

Â  Â  Â  Â  Â  Â  Â  Â  const oscillator = oscillatorRef.current;

Â  Â  Â  Â  Â  Â  Â  Â  const gainNode = gainNodeRef.cu
